

DECLARE CONTEXT
DECLARE DATE_INSERT
DECLARE CH
DECLARE ACTION
DECLARE MODULE
DECLARE BATCH
DECLARE TOKEN,,0
DECLARE QUEUE_ID,LONG
DECLARE LANG,,N
DECLARE OUTOFHOURS_CNT,WORD
DECLARE AFTER_CNT,WORD
DECLARE PARAM4
DECLARE filename
DECLARE EMAILBODY
DECLARE CELLOP
DECLARE PH
DECLARE sSQL
DECLARE a
DECLARE O_FNAME
DECLARE O_MNAME
DECLARE O_ADDR
DECLARE O_EMPLOYEE,WORD
DECLARE O_OVERDUE,WORD
DECLARE O_INN
DECLARE O_SALE,WORD
DECLARE O_PRODUCTS_ID,WORD
DECLARE LOANS_CNT,WORD
DECLARE ERRM
DECLARE L
DECLARE date
DECLARE CHTOGO,LONG
DECLARE sum
DECLARE INN,
DECLARE code
DECLARE currency,LONG
DECLARE INN_CNT,WORD
DECLARE CARD_CNT,WORD
DECLARE INN_LENGTH,WORD



GETSCRIPTVALUE "LANGUAGE",LANG
GETSCRIPTVALUE "MODULENAME",MODULE
GETQUEUE QUEUE_ID,ID
DBMSDSN DSN=crm,UID=mcc,PWD=mcc,Oracle
DBMS DRIVER=SQL Server;SERVER=IMB-MSSQLST;DATABASE=Server;UID=mcc;PWD=mcc;
LET MODULE=IVROUTOFHOURS
LET BATCH=ANI
LET CONTEXT="ivroutofhours"
CURRENTDATETIME DATE_INSERT
LET CH=Context
LET ACTION=Begin
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CONCAT PH,+38,ANI
MID ANI,0,3,CELLOP
CURRENTDATE date,-
MID date,0,10,date

LET sSQL="SELECT O_FNAME,O_MNAME,O_ADDR,O_EMPLOYEE,O_OVERDUE,DECODE(O_LANGUAGENAME,'Ukrainian','UA','Russian','RU')  AS LANG,O_INN,O_SALE,O_PRODUCTS_ID,ERRM FROM table(imb_ivr.T_PHONE_FOR_IVR_CODES ('#PH#'))"
REPLACE sSQL,#PH#,PH
EXECUTESQL(Oracle) sSQL
CLOSECURSOR(Oracle)
IF LANG== GOTO WOLANG(a)
IF DNIS==8196 GOTO 3080
IF MODULE==IVR3080 GOTO 3080
//IF MODULE==Cards_IVR GOTO CARDS
//LET LANG=UA

CONCAT filename,new_450_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
IF O_MNAME!= GOTO NAME(a)
CONCAT filename,new_451_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
IF CELLOP==050 GOTO 3080INFO(a)
IF CELLOP==066 GOTO 3080INFO(a)
IF CELLOP==095 GOTO 3080INFO(a)
IF CELLOP==099 GOTO 3080INFO(a)
IF CELLOP==067 GOTO 3080INFO(a)
IF CELLOP==068 GOTO 3080INFO(a)
IF CELLOP==096 GOTO 3080INFO(a)
IF CELLOP==097 GOTO 3080INFO(a)
IF CELLOP==098 GOTO 3080INFO(a)
IF CELLOP==039 GOTO 3080INFO(a)
IF CELLOP==063 GOTO 3080INFO(a)
IF CELLOP==093 GOTO 3080INFO(a)
GOTO OUTOFHOURS1

:3080
LET LANG=UA
LET L=LANG
CONCAT filename,new_450_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
IF O_MNAME!= GOTO NAME(a)
LOG O_MNAME
CONCAT filename,new_451_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
IF CELLOP==050 GOTO MTS(a)
IF CELLOP==066 GOTO MTS(a)
IF CELLOP==095 GOTO MTS(a)
IF CELLOP==099 GOTO MTS(a)
IF CELLOP==067 GOTO KS(a)
IF CELLOP==068 GOTO KS(a)
IF CELLOP==096 GOTO KS(a)
IF CELLOP==097 GOTO KS(a)
IF CELLOP==098 GOTO KS(a)
IF CELLOP==063 GOTO LIFE(a)
IF CELLOP==093 GOTO LIFE(a)
GOTO OUTOFHOURS1

:MTS (a)
CONCAT filename,new_426_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_62_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_60_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_58_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
RETURN

:KS (a)
CONCAT filename,new_426_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_62_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_61_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_58_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
RETURN

:LIFE (a)
CONCAT filename,new_426_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_62_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_59_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_58_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
RETURN

:NAME (a)
LET CONTEXT="name"
CURRENTDATETIME DATE_INSERT
LET CH=Call
LET ACTION=Answered
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CONCAT filename,O_FNAME,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,O_MNAME,.vox
INTERRUPTPLAY filename,,0
LET filename=
RETURN

:WOLANG (a)
LET LANG=UA
LET L=LANG
RETURN

:OUTOFHOURS1
IF O_PRODUCTS_ID==2 GOTO LOANS
INCREMENT OUTOFHOURS_CNT
CONCAT filename,new_7_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_71_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,balans_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_236_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_511_,LANG,.vox
//CONCAT filename,block_card_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_72_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_244_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_232_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,5,5
CURRENTDATETIME DATE_INSERT
LET CH=Options
LET ACTION=RESPONSE
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
IF RESPONSE==1 GOTO IVRINNTIME
IF RESPONSE==7 GOTO CARD_INN
IF RESPONSE==2 GOTO CARDS_OPERATORTIME
IF RESPONSE==3 GOTO E_BANKINGTIME
IF OUTOFHOURS_CNT==2 GOTO CARDS_OPERATORTIME
CONCAT filename,new_6_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO OUTOFHOURS1
HANGUP


:CARDS
INCREMENT OUTOFHOURS_CNT
INTERRUPTPLAY new_4_UA.vox,,0
INTERRUPTPLAY new_503_UA.vox,,0
INTERRUPTPLAY new_5_UA.VOX,,0
INTERRUPTPLAY new_71_UA.vox,,0
INTERRUPTPLAY new_5_RU.vox,,0
INTERRUPTPLAY new_72_RU.vox,,0
GETDIGITS 1,5,5
CURRENTDATETIME DATE_INSERT
LET CONTEXT="ivroutofhours"
LET CH=Options
LET ACTION=RESPONSE
INSERT INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
IF RESPONSE==1 GOTO UA
IF RESPONSE==2 GOTO RU
IF IVRLANGUAGE_CNT==2 GOTO CARDS_OPERATORTIME
INTERRUPTPLAY timeout538.vox,,0
GOTO CARDS

:UA
LET LANG=UA
GOTO AFTER

:RU
LET LANG=RU
GOTO AFTER


:AFTER
INCREMENT AFTER_CNT
CONCAT filename,ostatok_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_230_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_428_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_72_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_522_,LANG,.VOX
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_75_,LANG,.VOX
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,3,5,#
IF RESPONSE==1 GOTO IVRINNTIME
IF RESPONSE==2 GOTO CARDS_OPERATORTIME
IF RESPONSE==5 GOTO E_BANKINGTIME
IF AFTER_CNT==2 GOTO CARDS_OPERATORTIME
LET CONTEXT="ivroutofhours"
LET CH=Options
LET ACTION=RESPONSE
INSERT INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CONCAT filename,timeout538_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO AFTER


:IVRINNTIME
LET MODULE=IVROUTOFHOURS
SETSCRIPTVALUE MODULENAME,MODULE
SETSCRIPTVALUE LANGUAGE,LANG
SETSCRIPTVALUE INNNUMBER,O_INN
SCRIPTTRANSFER ivrselfcare2
HANGUP

:LOANS
LET CONTEXT="ivroutofhours_loans"
LET CH=Context
LET ACTION=Begin
INSERT INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
INCREMENT LOANS_CNT
CONCAT filename,new_7_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_71_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,3,5,#
IF LOANS_CNT==2 GOTO OUTOFHOURSOP
IF RESPONSE==1 GOTO IVRINNTIME
CONCAT filename,new_6_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO LOANS


:CARDS_AFTER
INCREMENT AFTER_CNT
CONCAT filename,ostatok_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_230_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_428_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_72_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,3,5,#
IF RESPONSE==1 GOTO INFO
IF RESPONSE==2 GOTO CARDS_OPERATORTIME
IF AFTER_CNT==2 GOTO CARDS_OPERATORTIME
LET CONTEXT="ivroutofhours"
LET CH=Options
LET ACTION=RESPONSE
INSERT () INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CONCAT filename,new_6_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO CARDS_AFTER

:INFO
CONCAT filename,new_529_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_46_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_449_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
HANGUP

:CARDS_OPERATORTIME
//FULLPLAYAMBIENT RING.VOX
//DIAL 0442474975,8101,CHTOGO,30
//!ONCONNECT
//CONNECT CHANNEL,CHTOGO,
//FREEZE
//HANGUP
CONCAT PARAM4,LANG,"_",CONTEXT,"_Cards_Huru"
CURRENTDATETIME DATE_INSERT
LET CH=PARAM4
LET ACTION=ToOperator
INSERT () INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
SETSCRIPTVALUE CRMPARAM4,PARAM4
CONCAT filename,new_11_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_14_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
ADDTOQUEUE Cards_Huru,Cards_Huru
FULLPLAYAMBIENT MUSIC.VOX
TRANSFERTOAGENTSYNC Cards_Huru,30000,RING.VOX,NOONE
HANGUP

:SENDMAIL
CONCAT EMAILBODY,call back client on phone no ,  ANI, he called at , CALLTIME,.
SENDEMAIL mail.imb.local,25,IMB\IMBMediatelMail,k2Ve=8asWa7UDrA,IMBMediatelMail@platinumbank.com.ua,cards-support@platinumbank.com.ua,,CARDS,EMAILBODY,0,CARDS_OPERATORTIME
LET CONTEXT=Send_mail
CURRENTDATETIME DATE_INSERT
LET CH=Email
LET ACTION=Sended_Client
INSERT INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CONCAT filename,new_410_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_746_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
HANGUP
:MAIN
FULLPLAYAMBIENT music.vox
TRANSFERTOAGENTSYNC Cards_Huru,40000,RING.VOX,NOONE
HANGUP
:WAITTHANKYOU
CONCAT filename,new_490_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO MAIN
:NOONE
CONCAT filename,new_407_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_408_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_71_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_409_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_378_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,3,3,#
IF RESPONSE==1 GOTO SENDMAIL
GOTO MAIN

:E_BANKINGTIME
INCREMENT AFTER_CNT
LET CONTEXT="ib_client"
LET CH=Context
LET ACTION=Begin
CURRENTDATETIME DATE_INSERT
INSERT () INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CONCAT filename,new_523_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_71_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_526_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_72_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_28_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_241_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_248_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_240_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
LET CONTEXT="ib_client"
LET CH=Context
LET ACTION=End
CURRENTDATETIME DATE_INSERT
INSERT () INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
ADDTOQUEUE CC e-banking,CC e-banking
GETDIGITS 1,5,5
IF AFTER_CNT==2 GOTO CARDS_OPERATORTIME
LET CONTEXT="e-banking"
LET CH=Options
LET ACTION=RESPONSE
INSERT () INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
IF RESPONSE==1 GOTO E_BANKING1
IF RESPONSE==2 GOTO E_BANKING1
IF RESPONSE==* GOTO E_BANKINGTIME
IF RESPONSE==# GOTO OUTOFHOURS1
GOTO E_BANKINGTIME

:E_BANKING1
CONCAT PARAM4,LANG,"_",CONTEXT,"_e-banking"
CURRENTDATETIME DATE_INSERT
LET CH=PARAM4
LET ACTION=ToOperator
INSERT () INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
SETSCRIPTVALUE CRMPARAM4,PARAM4
CONCAT filename,new_11_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_14_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
LET CONTEXT="ib_client"
LET CH=Options
LET ACTION=e-banking
CURRENTDATETIME DATE_INSERT
INSERT () INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
FULLPLAYAMBIENT MUSIC.VOX
TRANSFERTOAGENTSYNC CC e-banking,20000,RING.VOX,NOONE
HANGUP

:OUTOFHOURSOP
CONCAT filename,new_45_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
HANGUP


:3080INFO (a)
CONCAT filename,new_472_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_16_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
RETURN

:CC_NY1 (a)
CONCAT filename,new_3_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
INTERRUPTPLAY cc_ny_day1_UA.vox,,0
CONCAT filename,new_17_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_382_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_415_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_331_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_350_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_64_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_342_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_48_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
RETURN

:CC_NY2 (a)
CONCAT filename,new_3_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
INTERRUPTPLAY cc_ny_day2_UA.vox,,0
CONCAT filename,new_17_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_382_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_415_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_331_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
INTERRUPTPLAY new_devjatoi_UA.vox,,0
CONCAT filename,new_64_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_293_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_48_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
RETURN

:CC_NY3 (a)
CONCAT filename,new_3_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
INTERRUPTPLAY cc_ny_day2_UA.vox,,0
CONCAT filename,new_17_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_382_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_415_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_331_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
INTERRUPTPLAY new_devjatoi_UA.vox,,0
CONCAT filename,new_64_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_348_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_48_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
RETURN


:CARD_INN
INCREMENT INN_CNT
CONCAT filename,new_8_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 10,15,15
LET INN=RESPONSE
LEN RESPONSE,INN_LENGTH
IF INN_LENGTH==10 GOTO CARD_NUM
IF INN_CNT==3 GOTO CARDS_OPERATORTIME
CONCAT filename,new_12_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO CARD_INN

:CARD_NUM
INCREMENT CARD_CNT
CONCAT filename,new_504_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 4,15,15
LET code=RESPONSE
LET INN_LENGTH=
LEN RESPONSE,INN_LENGTH
IF INN_LENGTH==4 GOTO CARD_BALANCE
IF CARD_CNT==3 GOTO CARDS_OPERATORTIME
CONCAT filename,new_12_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO CARD_NUM


:CARD_BALANCE
SELECTCURSOR sum FROM GetCardSum(INN,code)
CLOSECURSOR
FINDSTRING sum,"error",0,currency
IF currency!=-1 GOTO WRONG_CARD
FINDSTRING sum,"UAH",0,currency
IF currency==-1 GOTO DOLLAR_BALANCE
CONCAT filename,balans_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
LET CONTEXT="card_balance"
LET CH="Message"
LET ACTION="End"
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
INSERT() INTO Cardbalance_log(DATE_INSERT,INN,code,ANI)
SAYMONEY sum,d:\MCC\Server\VOX\new_money,LANG
CONCAT filename,new_28_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_241_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_248_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_240_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,5,5
IF RESPONSE==* GOTO CARD_BALANCE
IF RESPONSE==# GOTO OUTOFHOURS1
HANGUP



:DOLLAR_BALANCE
FINDSTRING sum,"USD",0,currency
IF currency==-1 GOTO EURO_BALANCE
CONCAT filename,balans_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
LET CONTEXT="card_balance"
LET CH="Message"
LET ACTION="End"
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
INSERT() INTO Cardbalance_log(DATE_INSERT,INN,code,ANI)
SAYMONEY sum,d:\MCC\Server\VOX\new_money_dol,LANG
CONCAT filename,new_28_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_241_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_248_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_240_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,5,5
IF RESPONSE==* GOTO CARD_BALANCE
IF RESPONSE==# GOTO OUTOFHOURS1
HANGUP


:EURO_BALANCE
CONCAT filename,balans_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
LET CONTEXT="card_balance"
LET CH="Message"
LET ACTION="End"
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
INSERT() INTO Cardbalance_log(DATE_INSERT,INN,code,ANI)
SAYMONEY sum,d:\MCC\Server\VOX\new_money_eur,LANG
CONCAT filename,new_28_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_241_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_248_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_240_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,5,5
IF RESPONSE==* GOTO CARD_BALANCE
IF RESPONSE==# GOTO OUTOFHOURS1
HANGUP

:WRONG_CARD
CONCAT filename,new_12_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO CARD_INN












































































































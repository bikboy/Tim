CHECKFAILOVERSTATUS TOACTIVE

DECLARE sSQL,STRING
DECLARE LANG,STRING
DECLARE QUEUE_ID,LONG
DECLARE BATCH,STRING
DECLARE CONTEXT,STRING
DECLARE DATE_INSERT,STRING
DECLARE CH,STRING
DECLARE ACTION,STRING
DECLARE INN,LONG
DECLARE INN1,STRING,
DECLARE stopaccrualdate,STRING
DECLARE totalrestamount,LONG
DECLARE dealstate,LONG
DECLARE daysoverdue,LONG
DECLARE schedulendays,LONG
DECLARE status_date,
DECLARE nextpaymentminus3
DECLARE fullrepayment,FLOAT
DECLARE DATEINWORDS,STRING
DECLARE YEARINWORDS,STRING
DECLARE MONTHINWORDS,STRING
DECLARE DAYINWORDS,STRING
DECLARE MONTH,STRING
DECLARE DAY,STRING
DECLARE YEAR,STRING
DECLARE trans_date,STRING
DECLARE trans_amount,FLOAT
DECLARE filename,STRING
DECLARE IVRINN_CNT,WORD
DECLARE IVRACCOUNT_CNT,WORD
DECLARE OVERDUENEXT_CNT,WORD
DECLARE OVERDUE2_CNT,WORD
DECLARE CREDITPAID_CNT,WORD
DECLARE ENDOFTRANSACTIONS_CNT,WORD
DECLARE NOTRANSACTIONS_CNT,WORD
GETQUEUE QUEUE_ID,ID
DECLARE FROMIVR,STRING
DECLARE INN_LENGTH,WORD
DECLARE recorded,LONG,0
DECLARE finco,STRING
DECLARE giveallowdate1,STRING
DECLARE allowdate,STRING
DECLARE MODULE
DECLARE TOKEN
DECLARE PARAM4
DECLARE firstrepaydate
DECLARE card
DECLARE credit
DECLARE decide
DECLARE creditorcard
DECLARE ipoteka_auto_msb
DECLARE saledate
DECLARE tooperator,LONG
DECLARE creditpaid
DECLARE dealid
DECLARE SMS_INFO_CNT,LONG
DECLARE sms_type
DECLARE SMS_YEAR
DECLARE SMS_MONTH
DECLARE SMS_DATE
DECLARE SMS_SUM
DECLARE MESSAGE
DECLARE SMS_SUM1
DECLARE SMS_NUMBER_CNT,WORD
DECLARE NUMBER_LENGTH,LONG
DECLARE PHONE_NO
DECLARE Account_num
DECLARE STATUS,,0
DECLARE dealno
DECLARE accountno
DECLARE payment
DECLARE pereustupkano
DECLARE arcdate
DECLARE SMS_CNT,WORD
DECLARE DECIDE_CNT,WORD
DECLARE SCDOGOVOR_CNT,WORD
DECLARE doubled,WORD
DECLARE a,LONG,0
DECLARE Description
DECLARE SR_Area
DECLARE Begin_Date
DECLARE End_Date
DECLARE person_uid
DECLARE frp
DECLARE SR_Type,,credit prime
DECLARE nextpayment,FLOAT
DECLARE real_overdue,WORD

LET recorded=0
LET BATCH=ANI
GETSCRIPTVALUE "MODULENAME",MODULE
GETSCRIPTVALUE "LANGUAGE",LANG
GETSCRIPTVALUE "XXX",INN1
DBMS DRIVER=SQL Server;SERVER=imb-mssqlst;DATABASE=Server;UID=mcc;PWD=mcc;
DBMSDSN DSN=crm,UID=mcc,PWD=mcc,Oracle



IF INN1!= GOTO CHECK_INN2

:IVRINN

//CONCAT filename,new_68_,LANG,.vox
//INTERRUPTPLAY filename,,0
//LET filename=
//CONCAT filename,new_383_,LANG,.vox
//INTERRUPTPLAY filename,,0
//LET filename=
//GOTO IVRMAIN

INCREMENT IVRINN_CNT
LET CONTEXT=ivrinn
IF MODULE==IVROUTOFHOURS GOTO ivrinntime (a)
LOG MODULE
LET CH=Context
LET ACTION=Begin
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
LET CONTEXT=ivrselfcare
IF MODULE==IVROUTOFHOURS GOTO ivrinntime (a)
LET CH=Context
LET ACTION=Begin
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CONCAT filename,new_8_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 10,15,15
IF IVRINN_CNT==3 GOTO CC_SERVICE
SETSCRIPTVALUE CRMPARAM5,RESPONSE
LET CH=INNVerify
LET ACTION=
CONCAT ACTION,Read ,RESPONSE
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
LET INN1=RESPONSE
LEN RESPONSE,INN_LENGTH
IF INN_LENGTH==10 GOTO CHECK_INN
LET ACTION=Failed
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CONCAT filename,new_12_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO IVRINN

:CHECK_INN
SELECTCURSOR identifycode as INN FROM check_inn(RESPONSE)
CLOSECURSOR
IF INN>0 GOTO CHECK_INN2
GOTO INCORRECT_INN

:INCORRECT_INN
CONCAT filename,new_12_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
IF IVRINN_CNT==3 GOTO CC_SERVICE
LET ACTION=Failed
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
GOTO IVRINN

:CHECK_INN2
SELECTCURSOR card,credit,decide FROM check_inn_cards(INN1)
CLOSECURSOR
IF decide==1 GOTO DECIDE
IF card==0 GOTO IVRACCOUNT
IF credit==0 GOTO DECIDE
GOTO DECIDE

:DECIDE
INCREMENT DECIDE_CNT
CONCAT filename,new_505_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_71_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_506_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_72_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,15,15
IF RESPONSE==1 GOTO IVRACCOUNT
IF RESPONSE==2 GOTO CARD
CONCAT filename,new_12_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
IF DECIDE_CNT==3 GOTO CC_SERVICE
GOTO DECIDE

:CARD
LET ACTION=Verified
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
INCREMENT IVRACCOUNT_CNT
LET CONTEXT=ivrcard
LET CH=Context
LET ACTION=Begin
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CONCAT filename,new_504_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 4,15,15
LET CH=Card
LET ACTION=
CONCAT ACTION,Read ,RESPONSE
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
SETSCRIPTVALUE CRMPARAM3,RESPONSE
SELECTCURSOR dealid as dealid FROM dealid_by_card_inn(RESPONSE,INN1)
CLOSECURSOR
IF dealid>0 GOTO IVRSUMMARY
LET CONTEXT=ivrcard
LET CH=Context
LET ACTION=Failed
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CONCAT filename,new_12_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
IF IVRACCOUNT_CNT==3 GOTO CC_SERVICE
GOTO CARD

:CARD_ACCEPTED
LET CONTEXT=ivrcard
LET CH=Context
LET ACTION=Verified
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CONCAT filename,new_412_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_pravilniy_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO IVRSUMMARY

:IVRACCOUNT
LET ACTION=Verified
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
GOTO IVRACCOUNT1

:IVRACCOUNT1
INCREMENT IVRACCOUNT_CNT
LET CONTEXT=ivraccount
LET CH=Context
LET ACTION=Begin
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CONCAT filename,new_10_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 8,15,15
SETSCRIPTVALUE CRMPARAM6,RESPONSE
LET CH=Account
LET ACTION=
CONCAT ACTION,Read ,RESPONSE
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CONCAT filename,new_242_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
LET dealid=0
SELECTCURSOR dealid as dealid FROM dealid_by_account_inn(RESPONSE,INN1)
CLOSECURSOR
SELECTCURSOR finco FROM p_finco_new(dealid)
CLOSECURSOR
IF finco==2 GOTO FINCOQUEUE
IF dealid>0 GOTO IVRSUMMARY
SELECTCURSOR dealid as dealid FROM check_acc(RESPONSE)
CLOSECURSOR
IF dealid>0 GOTO IVRINN
CONCAT filename,new_12_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
LET ACTION=Failed
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
IF IVRACCOUNT_CNT==3 GOTO CC_SERVICE
GOTO IVRACCOUNT1


:IVRSUMMARY

//CONCAT filename,new_68_,LANG,.vox
//INTERRUPTPLAY filename,,0
//LET filename=
//CONCAT filename,new_383_,LANG,.vox
//INTERRUPTPLAY filename,,0
//LET filename=
//HANGUP



LET SR_Area=Credit
LET ACTION=Verified
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
LET CONTEXT=ivrsummary
LET CH=Context
LET ACTION=Begin
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
SELECTCURSOR creditorcard,ipoteka_auto_msb,doubled FROM alternateid_by_dealid(dealid)
CLOSECURSOR
IF doubled==1 GOTO CC_SERVICE
IF ipoteka_auto_msb==1 GOTO MORTGAGE
IF creditorcard==1 GOTO CARDSUMMARY
GOTO IVRSUMMARY1


:IVRSUMMARY1
LET CH=Message
LET ACTION=End
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
SELECTCURSOR nextpaymentminus3,dealstate,totalrestamount,daysoverdue,schedulendays,status_date,stopaccrualdate,fullrepayment,firstrepaydate,allowdate,giveallowdate1,saledate,nextpayment FROM CCPROC(dealid)
CLOSECURSOR
LET TOKEN=dealid
LET CH=Message
LET ACTION=Begin
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
//IF DNIS==8165 GOTO SCDOGOVOR
IF daysoverdue>2 GOTO COLLECTION_INBOUND
IF daysoverdue==1 GOTO CC_SERVICE
LET sSQL="select max(X_PTB_REAL_DUE_DAYS) as real_overdue from siebel.s_asset sas join SIEBEL.S_FN_ACCNT2_FNX s2 on sas.ROW_ID=s2.PAR_ROW_ID join siebel.s_contact con on sas.PR_CON_ID = con.ROW_ID where con.SOC_SECURITY_NUM = INN1"
EXECUTESQL(Oracle) sSQL
CLOSECURSOR(Oracle)
IF real_overdue>0 GOTO CC_SERVICE
//IF daysoverdue>0 GOTO OVERDUE
IF daysoverdue==0 GOTO OVERDUE0
IF daysoverdue==1 GOTO CC_SERVICE
IF daysoverdue>1 GOTO COLLECTION_INBOUND
HANGUP

:CARDSUMMARY
LET SR_Area=Card
SELECTCURSOR arcdate,nextpaymentminus3,dealstate,totalrestamount,daysoverdue,schedulendays,status_date,stopaccrualdate,fullrepayment,saledate,tooperator,creditpaid FROM Cardselfcare2(dealid)
CLOSECURSOR
LET CONTEXT=Cardsummary
LET TOKEN=dealid
LET CH=Message
LET ACTION=Begin
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
IF tooperator==1 GOTO CARDS_OPERATOR
//IF DNIS==8165 GOTO SCDOGOVORCARDS
LET allowdate=0
LEN saledate,tooperator
IF tooperator>0 GOTO CC_SERVICE
IF dealstate>1 GOTO CREDITPAID
IF creditpaid==1 GOTO NETDOLGA
IF fullrepayment<0 GOTO CREDITPAID
LEN stopaccrualdate,tooperator
IF tooperator>0 GOTO CARDS_OPERATOR
IF daysoverdue==1 GOTO CARDS_OPERATOR
IF daysoverdue>1 GOTO COLLECTION_INBOUND
LET sSQL="select max(X_PTB_REAL_DUE_DAYS) as real_overdue from siebel.s_asset sas join SIEBEL.S_FN_ACCNT2_FNX s2 on sas.ROW_ID=s2.PAR_ROW_ID join siebel.s_contact con on sas.PR_CON_ID = con.ROW_ID where con.SOC_SECURITY_NUM = INN1 "
EXECUTESQL(Oracle) sSQL
CLOSECURSOR(Oracle)
IF real_overdue!=0 GOTO CC_SERVICE
IF daysoverdue==0 GOTO OVERDUE0
HANGUP



:OVERDUE0
GOTO record(a)
LEN saledate,tooperator
IF tooperator>0 GOTO CC_SERVICE
LEN stopaccrualdate,tooperator
IF tooperator>0 GOTO CC_SERVICE
IF dealstate>1 GOTO CREDITPAID
IF totalrestamount==0 GOTO NETDOLGA
IF daysoverdue>2 GOTO COLLECTION_INBOUND
IF daysoverdue==1 GOTO CC_SERVICE
CONCAT filename,new_13_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
LET DAYINWORDS=
LET MONTHINWORDS=
LET YEARINWORDS=
DECLARE currentdate
CURRENTDATETIME currentdate
//LET DATEINWORDS=status_date
LET DATEINWORDS=currentdate
LOG DATEINSWORDS
MID DATEINWORDS,0,4,YEAR
MID DATEINWORDS,5,2,MONTH
MID DATEINWORDS,8,2,DAY
MID DATE_INSERT,8,2,DAY
CONCAT DAYINWORDS,d:\MCC\Server\VOX\new_dayinfo\,DAY,_,LANG,.vox
CONCAT MONTHINWORDS,d:\MCC\Server\VOX\new_month\,MONTH,_,LANG,.vox
CONCAT YEARINWORDS,d:\MCC\Server\VOX\new_year\,YEAR,_,LANG,.vox
INTERRUPTPLAY DAYINWORDS,FP,0
INTERRUPTPLAY MONTHINWORDS,FP,0
INTERRUPTPLAY YEARINWORDS,FP,0
IF allowdate==1 GOTO 701
IF firstrepaydate != GOTO FIRSTREPAY
IF fullrepayment < 0 GOTO OVERDUE00
GOTO FULLREPAYMENT

:FULLREPAYMENT
LET Description=
TRIM R,nextpaymentminus3,00:00:00
LET frp=fullrepayment
TRIM R,frp,0
CONCAT Description,frp,_грн,_дата:_,nextpaymentminus3
SELECT() dealno FROM ods_zdr_100215_main WHERE dealid = dealid
SELECT contragentid as person_uid FROM ods_deal WHERE id = dealid
CURRENTDATETIME Begin_Date
CURRENTDATETIME End_Date
INSERT() INTO IVRService2(CALLTRACEID,INN1,MODULE,SR_Type,SR_Area,CONTEXT,Begin_Date,End_Date,Description,dealno,DNIS,ANI,person_uid)
CONCAT filename,new_23_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
SAYMONEY fullrepayment,d:\MCC\Server\VOX\new_money,LANG
SELECTCURSOR trans_date,trans_amount FROM one_p(dealid)
CLOSECURSOR
IF trans_amount!= GOTO OVERDUE00
GOTO OVERDUENEXT
//GOTO OVERDUE00


:701
LET Description=
CONCAT Description,'сума к полному погашению кредита будет доступна c_',giveallowdate1
SELECT() dealno FROM ods_zdr_100215_main WHERE dealid = dealid
SELECT contragentid as person_uid FROM ods_deal WHERE id = dealid
CURRENTDATETIME Begin_Date
CURRENTDATETIME End_Date
INSERT() INTO IVRService2(CALLTRACEID,INN1,MODULE,SR_Type,SR_Area,CONTEXT,Begin_Date,End_Date,Description,dealno,DNIS,ANI,person_uid)
CONCAT filename,new_69_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
LET DAYINWORDS=
LET MONTHINWORDS=
LET YEARINWORDS=
LET DATEINWORDS=giveallowdate1
MID DATEINWORDS,0,4,YEAR
MID DATEINWORDS,5,2,MONTH
MID DATEINWORDS,8,2,DAY
CONCAT DAYINWORDS,d:\MCC\Server\VOX\new_day\,DAY,_,LANG,.vox
CONCAT MONTHINWORDS,d:\MCC\Server\VOX\new_month\,MONTH,_,LANG,.vox
CONCAT YEARINWORDS,d:\MCC\Server\VOX\new_year\,YEAR,_,LANG,.vox
INTERRUPTPLAY DAYINWORDS,FP,0
INTERRUPTPLAY MONTHINWORDS,FP,0
INTERRUPTPLAY YEARINWORDS,FP,0
GOTO OVERDUENEXT

:FIRSTREPAY
LET Description=
CONCAT Description,'сума к полному погашению будет доступна_',firstrepaydate
SELECT() dealno FROM ods_zdr_100215_main WHERE dealid = dealid
SELECT contragentid as person_uid FROM ods_deal WHERE id = dealid
CURRENTDATETIME Begin_Date
CURRENTDATETIME End_Date
INSERT() INTO IVRService2(CALLTRACEID,INN1,MODULE,SR_Type,SR_Area,CONTEXT,Begin_Date,End_Date,Description,dealno,DNIS,ANI,person_uid)
CONCAT filename,new_411_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_69_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
LET DAYINWORDS=
LET MONTHINWORDS=
LET YEARINWORDS=
LET DATEINWORDS=firstrepaydate
MID DATEINWORDS,0,4,YEAR
MID DATEINWORDS,5,2,MONTH
MID DATEINWORDS,8,2,DAY
CONCAT DAYINWORDS,d:\MCC\Server\VOX\new_day\,DAY,_,LANG,.vox
CONCAT MONTHINWORDS,d:\MCC\Server\VOX\new_month\,MONTH,_,LANG,.vox
CONCAT YEARINWORDS,d:\MCC\Server\VOX\new_year\,YEAR,_,LANG,.vox
INTERRUPTPLAY DAYINWORDS,FP,0
INTERRUPTPLAY MONTHINWORDS,FP,0
INTERRUPTPLAY YEARINWORDS,FP,0
GOTO OVERDUENEXT_NAVI


:OVERDUENEXT
INCREMENT SMS_CNT
IF CONTEXT==Cardsummary GOTO OVERDUENEXT_CARD
IF SMS_CNT>1 GOTO OVERDUENEXT_NAVI
IF nextpaymentminus3== GOTO OVERDUENEXT_NAVI
CONCAT filename,new_26_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
LET DAYINWORDS=
LET MONTHINWORDS=
LET YEARINWORDS=
LET DATEINWORDS=nextpaymentminus3
MID DATEINWORDS,0,4,YEAR
MID DATEINWORDS,5,2,MONTH
MID DATEINWORDS,8,2,DAY
CONCAT DAYINWORDS,"d:\\MCC\\Server\\VOX\\new_day\\",DAY,"_",LANG,".vox"
CONCAT MONTHINWORDS,"d:\\MCC\\Server\\VOX\\new_month\\",MONTH,"_",LANG,".vox"
CONCAT YEARINWORDS,"d:\\MCC\\Server\\VOX\\new_year\\",YEAR,"_",LANG,".vox"
INTERRUPTPLAY DAYINWORDS,FP,0
INTERRUPTPLAY MONTHINWORDS,FP,0
INTERRUPTPLAY YEARINWORDS,FP,0
CONCAT filename,new_25_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
SAYMONEY nextpayment,"d:\\MCC\\Server\\VOX\\new_money",LANG
GOTO OVERDUENEXT_NAVI

:OVERDUENEXT_CARD
INCREMENT SMS_CNT
IF SMS_CNT>3 GOTO OVERDUENEXT_NAVI
IF nextpaymentminus3== GOTO OVERDUENEXT_NAVI
CONCAT filename,new_26_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
LET DAYINWORDS=
LET MONTHINWORDS=
LET YEARINWORDS=
LET DATEINWORDS=nextpaymentminus3
MID DATEINWORDS,0,4,YEAR
MID DATEINWORDS,5,2,MONTH
MID DATEINWORDS,8,2,DAY
CONCAT DAYINWORDS,"d:\\MCC\\Server\\VOX\\new_day\\",DAY,"_",LANG,".vox"
CONCAT MONTHINWORDS,"d:\\MCC\\Server\\VOX\\new_month\\",MONTH,"_",LANG,".vox"
CONCAT YEARINWORDS,"d:\\MCC\\Server\\VOX\\new_year\\",YEAR,"_",LANG,".vox"
INTERRUPTPLAY DAYINWORDS,FP,0
INTERRUPTPLAY MONTHINWORDS,FP,0
INTERRUPTPLAY YEARINWORDS,FP,0
GOTO OVERDUENEXT_NAVI


:OVERDUENEXT_NAVI
INCREMENT OVERDUENEXT_CNT
CONCAT filename,new_248_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_230_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_251_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_231_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO OVERDUENEXT_NAVI1

:OVERDUENEXT_NAVI1
//IF MODULE!=IVROUTOFHOURS GOTO IVR9(a)
//IF DNIS==8165 GOTO 5SMS(a)
CONCAT filename,new_28_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_239_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_245_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_79_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,10,10
CURRENTDATETIME DATE_INSERT
LET CH=Options
LET ACTION=RESPONSE
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
LET CH=Options
LET ACTION=End
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
LET CH=Message
LET ACTION=End
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
IF RESPONSE==1 GOTO OVERDUE0
IF RESPONSE==2 GOTO IVRDETAIL
IF RESPONSE==5 GOTO SMSINFO
IF RESPONSE==9 GOTO PTBMAIN
IF RESPONSE==0 GOTO IVRMAIN
IF OVERDUENEXT_CNT==3 GOTO CC_SERVICE
CONCAT filename,new_6_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO OVERDUENEXT_NAVI

:5SMS (a)
CONCAT filename,sms_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,main6_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
RETURN

:IVR9 (a)
CONCAT filename,new_245_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_79_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
RETURN


:OVERDUE00
SELECTCURSOR trans_date,trans_amount FROM one_p(dealid)
CLOSECURSOR
CONCAT filename,new_24_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
LET DAYINWORDS=
LET MONTHINWORDS=
LET YEARINWORDS=
LET DATEINWORDS=trans_date
MID DATEINWORDS,0,4,YEAR
MID DATEINWORDS,5,2,MONTH
MID DATEINWORDS,8,2,DAY
CONCAT DAYINWORDS,d:\MCC\Server\VOX\new_day\,DAY,_,LANG,.vox
CONCAT MONTHINWORDS,d:\MCC\Server\VOX\new_month\,MONTH,_,LANG,.vox
CONCAT YEARINWORDS,d:\MCC\Server\VOX\new_year\,YEAR,_,LANG,.vox
INTERRUPTPLAY DAYINWORDS,FP,0
INTERRUPTPLAY MONTHINWORDS,FP,0
INTERRUPTPLAY YEARINWORDS,FP,0
CONCAT filename,new_25_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
SAYMONEY trans_amount,d:\MCC\Server\VOX\new_money,LANG
GOTO OVERDUENEXT

:OVERDUE
CONCAT filename,ivr-deal-overdue_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
IF daysoverdue<=30 GOTO OVERDUE30
GOTO OVERDUE2

:OVERDUE30
CONCAT filename,ivr-back-to-schedule_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
SAYMONEY schedulendays,d:\MCC\Server\VOX\money,LANG
GOTO OVERDUE2

:OVERDUE2
CONCAT filename,info_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
LET DATEINWORDS=status_date
LET DAYINWORDS=
LET MONTHINWORDS=
LET YEARINWORDS=
MID DATEINWORDS,0,4,YEAR
MID DATEINWORDS,5,2,MONTH
MID DATEINWORDS,8,2,DAY
CONCAT DAYINWORDS,d:\MCC\Server\VOX\dayinfo\,DAY,_,LANG,.vox
CONCAT MONTHINWORDS,d:\MCC\Server\VOX\month\,MONTH,_,LANG,.vox
CONCAT YEARINWORDS,d:\MCC_Server\VOX\year\,YEAR,_,LANG,.vox
INTERRUPTPLAY DAYINWORDS,FP,0
INTERRUPTPLAY MONTHINWORDS,FP,0
INTERRUPTPLAY YEARINWORDS,FP,0
CONCAT filename,ivr-full-repayment_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
SAYMONEY fullrepayment,d:\MCC\Server\VOX\money,LANG
GOTO OVERDUE2_NAVI

:OVERDUE2_NAVI
INCREMENT OVERDUE2_CNT

CONCAT filename,ivr-option-repeat1_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,ivr-option-detail2_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,ivr-option-operator9_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,ivr-option-back0_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,10,10
CURRENTDATETIME DATE_INSERT
LET CH=Options
LET ACTION=RESPONSE
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
LET CH=Options
LET ACTION=End
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
LET CH=Message
LET ACTION=End
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
IF RESPONSE==1 GOTO IVRSUMMARY1
IF RESPONSE==2 GOTO IVRDETAIL
IF RESPONSE==9 GOTO PTBMAIN
IF RESPONSE==0 GOTO IVRMAIN
IF OVERDUE2_CNT==2 GOTO CC_SERVICE
CONCAT filename,timeout538_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO OVERDUE2_NAVI

:CREDITPAID
LET Description=
TRIM R,nextpaymentminus3,00:00:00
LET frp=fullrepayment
TRIM R,frp,0
CONCAT Description,frp,_грн,_дата:_,nextpaymentminus3
SELECT() dealno FROM ods_zdr_100215_main WHERE dealid = dealid
SELECT contragentid as person_uid FROM ods_deal WHERE id = dealid
CURRENTDATETIME Begin_Date
CURRENTDATETIME End_Date
INSERT() INTO IVRService2(CALLTRACEID,INN1,MODULE,SR_Type,SR_Area,CONTEXT,Begin_Date,End_Date,Description,dealno,DNIS,ANI,person_uid)
CONCAT filename,new_54_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO CREDITPAID_NAVI


:NETDOLGA
LET Description=
TRIM R,nextpaymentminus3,00:00:00
LET frp=fullrepayment
TRIM R,frp,0
CONCAT Description,frp,_грн,_дата:_,nextpaymentminus3
SELECT() dealno FROM ods_zdr_100215_main WHERE dealid = dealid
SELECT contragentid as person_uid FROM ods_deal WHERE id = dealid
CURRENTDATETIME Begin_Date
CURRENTDATETIME End_Date
INSERT() INTO IVRService2(CALLTRACEID,INN1,MODULE,SR_Type,SR_Area,CONTEXT,Begin_Date,End_Date,Description,dealno,DNIS,ANI,person_uid)
//CONCAT filename,new_22_,LANG,.vox
CONCAT filename,new_netdolga_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO CREDITPAID_NAVI

:CREDITPAID_NAVI
INCREMENT CREDITPAID_CNT
CONCAT filename,new_248_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_230_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_251_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_231_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO CREDITPAID_NAVI1

:CREDITPAID_NAVI1
//IF MODULE!=IVROUTOFHOURS GOTO IVR9(a)
//IF DNIS==8165 GOTO 5SMS(a)
CONCAT filename,new_28_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_239_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_245_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_79_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,10,10
CURRENTDATETIME DATE_INSERT
LET CH=Options
LET ACTION=RESPONSE
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
LET CH=Options
LET ACTION=End
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
LET CH=Message
LET ACTION=End
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
IF RESPONSE==1 GOTO OVERDUE0
IF RESPONSE==2 GOTO IVRDETAIL
IF RESPONSE==5 GOTO SMSINFO
IF RESPONSE==9 GOTO PTBMAIN
IF RESPONSE==0 GOTO IVRMAIN
IF CREDITPAID_CNT == 3 GOTO CC_SERVICE
CONCAT filename,new_6_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO CREDITPAID_NAVI

:SCDOGOVOR
LET CONTEXT=ivrsummary
LET CH=Context
LET ACTION=Begin
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
LEN saledate,tooperator
IF tooperator>0 GOTO CC_SERVICE
LEN stopaccrualdate,tooperator
IF tooperator>0 GOTO CC_SERVICE
IF dealstate>1 GOTO CREDITPAID
IF totalrestamount==0 GOTO NETDOLGA
IF daysoverdue>2 GOTO COLLECTION_INBOUND
IF daysoverdue==1 GOTO CC_SERVICE
INCREMENT SCDOGOVOR_CNT
SELECTCURSOR pereustupkano as pereustupkano FROM pereustupka_by_dealid(dealid)
CLOSECURSOR
CONCAT filename,new_38_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_230_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_prosluhaty_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_231_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,5,5,
IF RESPONSE==1 GOTO SMSINFO
IF RESPONSE==2 GOTO OVERDUE0
CONCAT filename,new_12_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
IF SCDOGOVOR_CNT==3 TERMINATE
GOTO SCDOGOVOR

:SMSINFO
LET CONTEXT=mivrsms
LET CH=Context
LET ACTION=Begin
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
SELECTCURSOR dealno,accountno,payment FROM accdealno_by_dealid(dealid)
INCREMENT SMS_INFO_CNT
IF SMS_INFO_CNT==3 GOTO MIVR_OP
CONCAT filename,new_39_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_230_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_40_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_231_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_41_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_232_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,5,5,
LOG RESPONSE
IF RESPONSE==1 GOTO SMSBALANCE
IF RESPONSE==2 GOTO SMSPAYMENTS
IF RESPONSE==3 GOTO SMSREQUISITES
GOTO SMSINFO


:SMSBALANCE
IF pereustupkano!= GOTO SMSPEREUSTUPKA
IF dealstate>1 GOTO SMSCREDITPAID
IF allowdate==1 GOTO SMSVYDAVAT
IF firstrepaydate != GOTO SMSFIRSTREPAY
IF daysoverdue>1 GOTO SMSBALANCEOVERDUE
LET sms_type=1
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-BALANCE
LET CH=SMS
LET ACTION=Begin
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
MID status_date,0,4,SMS_YEAR
MID status_date,5,2,SMS_MONTH
MID status_date,8,2,SMS_DATE
LET SMS_SUM=fullrepayment
REPLACE SMS_SUM,0000,
CONCAT MESSAGE,"Zalushok za kreditom No"," ",dealno," ","skladae"," ",SMS_SUM," ","hrn na"," ",SMS_DATE,".",SMS_MONTH,".",SMS_YEAR," ","Platinum Bank."
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-BALANCE
LET CH=SMS
LET ACTION=Created
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
GOTO SMSNUMBER

:SMSVYDAVAT
LET sms_type=15
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-BALANCE-COLLECTION
LET CH=SMS
LET ACTION=Begin
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
MID giveallowdate1,0,4,SMS_YEAR
MID giveallowdate1,5,2,SMS_MONTH
MID giveallowdate1,8,2,SMS_DATE
CONCAT MESSAGE,"Zalushok za kreditom No"," ",dealno," ","bude dostupnym"," " ,SMS_DATE,".",SMS_MONTH,".",SMS_YEAR," ",".Platinum Bank."
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-BALANCE
LET CH=SMS
LET ACTION=Created
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
GOTO SMSNUMBER

:SMSFIRSTREPAY
LET sms_type=15
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-BALANCE-COLLECTION
LET CH=SMS
LET ACTION=Begin
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
MID firstrepaydate,0,4,SMS_YEAR
MID firstrepaydate,5,2,SMS_MONTH
MID firstrepaydate,8,2,SMS_DATE
CONCAT MESSAGE,"Zalushok za kreditom No"," ",dealno," ","bude dostupnym"," " ,SMS_DATE,".",SMS_MONTH,".",SMS_YEAR," ",".Platinum Bank."
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-BALANCE
LET CH=SMS
LET ACTION=Created
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
GOTO SMSNUMBER


:SMSBALANCEOVERDUE
LET sms_type=5
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-BALANCE-COLLECTION
LET CH=SMS
LET ACTION=Begin
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
MID status_date,0,4,SMS_YEAR
MID status_date,5,2,SMS_MONTH
MID status_date,8,2,SMS_DATE
LET SMS_SUM=fullrepayment
REPLACE SMS_SUM,0000,
CONCAT MESSAGE,"Zalushok za kreditom No"," ",dealno," ","skladae"," ",SMS_SUM," ","hrn na"," ",SMS_DATE,".",SMS_MONTH,".",SMS_YEAR," ",".Uvaga Za kredytom isnuje prostrochena zaborgovanist! Detali - 0443937064"
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-BALANCE
LET CH=SMS
LET ACTION=Created
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
GOTO SMSNUMBER

:SMSPAYMENTS
IF pereustupkano!= GOTO SMSPEREUSTUPKA
IF dealstate>1 GOTO SMSCREDITPAID
IF daysoverdue>1 GOTO SMSPAYMENTSOVERDUE
LET sms_type=2
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-PAYMENTS
LET CH=SMS
LET ACTION=Begin
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
SELECTCURSOR trans_date,trans_amount FROM one_p(dealid)
CLOSECURSOR
IF trans_amount==0 GOTO NOPAYMENTS
MID trans_date,0,4,SMS_YEAR
MID trans_date,5,2,SMS_MONTH
MID trans_date,8,2,SMS_DATE
LET SMS_SUM=trans_amount
REPLACE SMS_SUM,0000,
CONCAT MESSAGE,"Za kreditom No"," " , dealno," " ,"nadijshla oplata"," " ,SMS_SUM," " ,"hrn."," ",SMS_DATE,".",SMS_MONTH,".",SMS_YEAR," ",".Platinum Bank."
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-PAYMENTS
LET CH=SMS
LET ACTION=Created
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
GOTO SMSNUMBER

:NOPAYMENTS
LET sms_type=2
CURRENTDATETIME DATE_INSERT
LET CONTEXT=NO-PAYMENTS
LET CH=SMS
LET ACTION=Begin
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CONCAT MESSAGE,"Za kreditom No"," ",dealno," ","oplati vidsutni. Platinum Bank."
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-PAYMENTS
LET CH=SMS
LET ACTION=Created
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
GOTO SMSNUMBER


:SMSPAYMENTSOVERDUE
LET sms_type=6
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-PAYMENTS-COLLECTION
LET CH=SMS
LET ACTION=Begin
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
SELECTCURSOR trans_date,trans_amount FROM one_p(dealid)
CLOSECURSOR
MID trans_date,0,4,SMS_YEAR
MID trans_date,5,2,SMS_MONTH
MID trans_date,8,2,SMS_DATE
LET SMS_SUM=trans_amount
LET SMS_SUM1=schedulendays
REPLACE SMS_SUM,0000,
REPLACE SMS_SUM1,0000,
CONCAT MESSAGE,"Ostannya oplata nadijshla"," ",SMS_DATE,".",SMS_MONTH,".",SMS_YEAR," ","v sumi"," ",SMS_SUM," "," hrn."," ","Za kredytom No"," ",dealno," ","isnuje prostrochena zaborgovanist!"," ",SMS_SUM1," ","grn Detali 0443937064"
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-PAYMENTS
LET CH=SMS
LET ACTION=Created
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
GOTO SMSNUMBER


:SMSREQUISITES
DECLARE EDRPOU
DECLARE ifcard
IF pereustupkano!= GOTO SMSPEREUSTUPKA
IF dealstate>1 GOTO SMSCREDITPAID
IF daysoverdue>1 GOTO SMSREQUISITESOVERDUE
LET sms_type=3
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-REQUISITES
LET CH=SMS
LET ACTION=Begin
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
SELECTCURSOR trans_date,trans_amount FROM one_p(dealid)
CLOSECURSOR
MID status_date,0,4,SMS_YEAR
MID status_date,5,2,SMS_MONTH
MID status_date,8,2,SMS_DATE
LET SMS_SUM=payment
REPLACE SMS_SUM,0000,
MID accountno,0,4,ifcard
LET EDRPOU=33308489
IF ifcard==2625 GOTO EDRPOU_CARD(a)
CONCAT MESSAGE,"Suma"," ",SMS_SUM," ","grn na"," ",SMS_DATE,".",SMS_MONTH,".",SMS_YEAR," ","Otrymuvach: PAT 'Platynum Bank' EDRPOU"," ",EDRPOU," "," Rakhunok No"," ",accountno," ","MFO 380388.Pryznachennja: Za kredit No"," ",dealno
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-REQUISITES
LET CH=SMS
LET ACTION=Created
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
GOTO SMSNUMBER

:EDRPOU_CARD(a)
LET EDRPOU=INN1
RETURN

:SMSREQUISITESOVERDUE
LET sms_type=7
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-REQUISITES-COLLECTION
LET CH=SMS
LET ACTION=Begin
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
SELECTCURSOR trans_date,trans_amount FROM one_p(dealid)
CLOSECURSOR
MID status_date,0,4,SMS_YEAR
MID status_date,5,2,SMS_MONTH
MID status_date,8,2,SMS_DATE
LET SMS_SUM=payment
REPLACE SMS_SUM,0000,
CONCAT MESSAGE,"Otrymuvach: PAT 'Platynum Bank' EDRPOU 33308489 Rakhunok"," ",accountno,",",". MFO 380388.Pryznachennja: Za kredit No:",dealno, ,".Suma do splaty"," ",SMS_SUM," " ,"grn Detali 0443937064"
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-REQUISITES
LET CH=SMS
LET ACTION=Created
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
GOTO SMSNUMBER


:SMSCREDITPAID
LET sms_type=4
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-KREDIT-ZAKRYT
LET CH=SMS
LET ACTION=Begin
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CONCAT MESSAGE,"Kreditnu ugodu No"," ",dealno," ","zakrito.Dyakuiemo za spivpracyu.Platinum Bank."
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-BALANCE
LET CH=SMS
LET ACTION=Created
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
GOTO SMSNUMBER

:SMSPEREUSTUPKA
LET sms_type=8
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-PEREUSTUPKA
LET CH=SMS
LET ACTION=Begin
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CONCAT MESSAGE,"Kredit No"," " ,dealno," ", "pereustupleno. Detali za nomerom"," ",pereustupkano,". Platinum Bank."
GOTO SMSNUMBER

:SCDOGOVORCARDS
SELECTCURSOR pereustupkano as pereustupkano FROM pereustupka_by_dealid(dealid)
CLOSECURSOR
LET allowdate=0
LEN saledate,tooperator
IF tooperator>0 GOTO CC_SERVICE
IF dealstate>1 GOTO CREDITPAID
IF creditpaid==1 GOTO NETDOLGA
IF fullrepayment<0 GOTO CREDITPAID
IF tooperator==1 GOTO CARDS_OPERATOR
LEN stopaccrualdate,tooperator
IF daysoverdue==1 GOTO CARDS_OPERATOR
IF daysoverdue>1 GOTO COLLECTION_INBOUND
CONCAT filename,new_38_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_230_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_7_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_72_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,5,5,
IF RESPONSE==1 GOTO SMSINFOCARDS
IF RESPONSE==2 GOTO OVERDUE0
HANGUP


:SMSINFOCARDS
LET CONTEXT=mivrsms
LET CH=Context
LET ACTION=Begin
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
SELECTCURSOR dealno,accountno FROM accdealno_by_dealid(dealid)
INCREMENT SMS_INFO_CNT
IF SMS_INFO_CNT==3 GOTO MIVR_OP
CONCAT filename,new_39_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_230_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_40_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_231_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_41_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_232_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,5,5,
LOG RESPONSE
IF RESPONSE==1 GOTO SMSBALANCE
IF RESPONSE==2 GOTO SMSPAYMENTS
IF RESPONSE==3 GOTO SMSREQUISITESCARDS
GOTO SMSINFO

:SMSREQUISITESCARDS
IF dealstate>1 GOTO SMSCREDITPAID
IF daysoverdue>1 GOTO SMSREQUISITESOVERDUECARDS
LET sms_type=3
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-REQUISITES
LET CH=SMS
LET ACTION=Begin
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
SELECTCURSOR trans_date,trans_amount FROM one_p(dealid)
CLOSECURSOR
MID status_date,0,4,SMS_YEAR
MID status_date,5,2,SMS_MONTH
MID status_date,8,2,SMS_DATE
LET SMS_SUM=payment
REPLACE SMS_SUM,0000,
CONCAT MESSAGE,"Suma ",SMS_SUM," grn. na ",SMS_DATE,".",SMS_MONTH,".",SMS_YEAR," Otrymuvach: PAT 'Platinum Bank' EDRPOU 33308489",INN1 ," Rakhunok No ",accountno," MFO 380388.Pryznachennja: Za kredit No",dealno
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-REQUISITES
LET CH=SMS
LET ACTION=Created
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
GOTO SMSNUMBER

:SMSREQUISITESOVERDUECARDS
LET sms_type=7
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-REQUISITES-OVERDUE
LET CH=SMS
LET ACTION=Begin
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
SELECTCURSOR trans_date,trans_amount FROM one_p(dealid)
CLOSECURSOR
MID status_date,0,4,SMS_YEAR
MID status_date,5,2,SMS_MONTH
MID status_date,8,2,SMS_DATE
LET SMS_SUM=payment
REPLACE SMS_SUM,0000,
CONCAT MESSAGE,"Otrymuvach: PAT 'Platinum Bank' EDRPOU 33308489", INN1 , "Rakhunok No ",accountno," MFO 380388.Pryznachennja: Za kreditom No",dealno,"isnuje prostrochena zaborgovanist  ",SMS_SUM, "grn Detali 0443937064"
CURRENTDATETIME DATE_INSERT
LET CONTEXT=SMS-REQUISITES
LET CH=SMS
LET ACTION=Created
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
GOTO SMSNUMBER


:SMSNUMBER
INCREMENT SMS_NUMBER_CNT
IF SMS_NUMBER_CNT==3 GOTO MIVR_OP
CONCAT filename,583_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 10,15,15
LEN RESPONSE,NUMBER_LENGTH
IF NUMBER_LENGTH != 10 GOTO SMSNUMBER
LET PHONE_NO=RESPONSE
LET Account_num=accountno
INSERT() INTO sms(PHONE_NO,MESSAGE,STATUS,MODULE,sms_type,Account_num)
CONCAT filename,new_481_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
HANGUP


:IVRDETAIL
CURRENTDATETIME DATE_INSERT
LET CONTEXT=ivrdetail
LET CH=Context
LET ACTION=Begin
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CURRENTDATETIME Begin_Date
CURRENTDATETIME End_Date
LET Description=
SELECT() dealno FROM ods_zdr_100215_main WHERE dealid = dealid
SELECT contragentid as person_uid FROM ods_deal WHERE id = dealid
INSERT() INTO IVRService2(CALLTRACEID,INN1,MODULE,SR_Type,SR_Area,CONTEXT,Begin_Date,End_Date,Description,dealno,DNIS,ANI,person_uid)
LET trans_amount=0
SELECTCURSOR trans_date,trans_amount FROM five_p(dealid)
IF trans_amount==0 GOTO NOTRANSACTIONS
CONCAT filename,new_532_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
LET DATEINWORDS=trans_date
LET DAYINWORDS=
LET MONTHINWORDS=
LET YEARINWORDS=
MID DATEINWORDS,0,4,YEAR
MID DATEINWORDS,5,2,MONTH
MID DATEINWORDS,8,2,DAY
CONCAT DAYINWORDS,d:\MCC\Server\VOX\new_day\,DAY,_,LANG,.vox
CONCAT MONTHINWORDS,d:\MCC\Server\VOX\new_month\,MONTH,_,LANG,.vox
CONCAT YEARINWORDS,d:\MCC\Server\VOX\new_year\,YEAR,_,LANG,.vox
INTERRUPTPLAY DAYINWORDS,FP,0
INTERRUPTPLAY MONTHINWORDS,FP,0
INTERRUPTPLAY YEARINWORDS,FP,0
CONCAT filename,new_20_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
SAYMONEY trans_amount,d:\MCC\Server\VOX\new_money,LANG
FETCHCURSOR
IF CURSORSTATE==1 GOTO ENDOFTRANSACTIONS
LET DATEINWORDS=trans_date
LET DAYINWORDS=
LET MONTHINWORDS=
LET YEARINWORDS=
MID DATEINWORDS,0,4,YEAR
MID DATEINWORDS,5,2,MONTH
MID DATEINWORDS,8,2,DAY
CONCAT DAYINWORDS,d:\MCC\Server\VOX\new_day\,DAY,_,LANG,.vox
CONCAT MONTHINWORDS,d:\MCC\Server\VOX\new_month\,MONTH,_,LANG,.vox
CONCAT YEARINWORDS,d:\MCC\Server\VOX\new_year\,YEAR,_,LANG,.vox
INTERRUPTPLAY DAYINWORDS,FP,0
INTERRUPTPLAY MONTHINWORDS,FP,0
INTERRUPTPLAY YEARINWORDS,FP,0
CONCAT filename,new_20_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
SAYMONEY trans_amount,d:\MCC\Server\VOX\new_money,LANG
FETCHCURSOR
IF CURSORSTATE==1 GOTO ENDOFTRANSACTIONS
LET DATEINWORDS=trans_date
LET DAYINWORDS=
LET MONTHINWORDS=
LET YEARINWORDS=
MID DATEINWORDS,0,4,YEAR
MID DATEINWORDS,5,2,MONTH
MID DATEINWORDS,8,2,DAY
CONCAT DAYINWORDS,d:\MCC\Server\VOX\new_day\,DAY,_,LANG,.vox
CONCAT MONTHINWORDS,d:\MCC\Server\VOX\new_month\,MONTH,_,LANG,.vox
CONCAT YEARINWORDS,d:\MCC\Server\VOX\new_year\,YEAR,_,LANG,.vox
INTERRUPTPLAY DAYINWORDS,FP,0
INTERRUPTPLAY MONTHINWORDS,FP,0
INTERRUPTPLAY YEARINWORDS,FP,0
CONCAT filename,new_20_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
SAYMONEY trans_amount,d:\MCC\Server\VOX\new_money,LANG
FETCHCURSOR
IF CURSORSTATE==1 GOTO ENDOFTRANSACTIONS
LET DATEINWORDS=trans_date
LET DAYINWORDS=
LET MONTHINWORDS=
LET YEARINWORDS=
MID DATEINWORDS,0,4,YEAR
MID DATEINWORDS,5,2,MONTH
MID DATEINWORDS,8,2,DAY
CONCAT DAYINWORDS,d:\MCC\Server\VOX\new_day\,DAY,_,LANG,.vox
CONCAT MONTHINWORDS,d:\MCC\Server\VOX\new_month\,MONTH,_,LANG,.vox
CONCAT YEARINWORDS,d:\MCC\Server\VOX\new_year\,YEAR,_,LANG,.vox
INTERRUPTPLAY DAYINWORDS,FP,0
INTERRUPTPLAY MONTHINWORDS,FP,0
INTERRUPTPLAY YEARINWORDS,FP,0
CONCAT filename,new_20_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
SAYMONEY trans_amount,d:\MCC\Server\VOX\new_money,LANG
FETCHCURSOR
IF CURSORSTATE==1 GOTO ENDOFTRANSACTIONS
LET DATEINWORDS=trans_date
LET DAYINWORDS=
LET MONTHINWORDS=
LET YEARINWORDS=
MID DATEINWORDS,0,4,YEAR
MID DATEINWORDS,5,2,MONTH
MID DATEINWORDS,8,2,DAY
CONCAT DAYINWORDS,d:\MCC\Server\VOX\new_day\,DAY,_,LANG,.vox
CONCAT MONTHINWORDS,d:\MCC\Server\VOX\new_month\,MONTH,_,LANG,.vox
CONCAT YEARINWORDS,d:\MCC\Server\VOX\new_year\,YEAR,_,LANG,.vox
INTERRUPTPLAY DAYINWORDS,FP,0
INTERRUPTPLAY MONTHINWORDS,FP,0
INTERRUPTPLAY YEARINWORDS,FP,0
CONCAT filename,new_20_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
SAYMONEY trans_amount,d:\MCC\Server\VOX\new_money,LANG
CLOSECURSOR
GOTO ENDOFTRANSACTIONS

:ENDOFTRANSACTIONS
LET CONTEXT=ivrdetail
LET CH=Message
LET ACTION=End
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CURRENTDATETIME End_Date
UPDATE() IVRService2 SET End_Date=End_Date WHERE CALLTRACEID=CALLTRACEID AND CONTEXT='ivrdetail'
CONCAT filename,new_21_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO ENDOFTRANSACTIONS_NAVI

:ENDOFTRANSACTIONS_NAVI
INCREMENT ENDOFTRANSACTIONS_CNT
CONCAT filename,new_248_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_230_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_245_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_79_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_28_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_239_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,10,10
CURRENTDATETIME DATE_INSERT
LET CH=Options
LET ACTION=RESPONSE
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CURRENTDATETIME DATE_INSERT
LET CH=Options
LET ACTION=End
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
IF RESPONSE==1 GOTO IVRDETAIL
IF RESPONSE==9 GOTO PTBMAIN
IF RESPONSE==0 GOTO IVRMAIN
IF ENDOFTRANSACTIONS_CNT==3 GOTO CC_SERVICE
CONCAT filename,new_6_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO ENDOFTRANSACTIONS_NAVI

:NOTRANSACTIONS
CONCAT filename,new_22_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO NOTRANSACTIONS_NAVI

:NOTRANSACTIONS_NAVI
INCREMENT NOTRANSACTIONS_CNT
CONCAT filename,new_248_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_230_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_245_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_79_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_28_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_239_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,10,10
CURRENTDATETIME DATE_INSERT
LET CH=Options
LET ACTION=RESPONSE
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CURRENTDATETIME DATE_INSERT
LET CH=Options
LET ACTION=End
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
IF RESPONSE==1 GOTO IVRDETAIL
IF RESPONSE==9 GOTO PTBMAIN
IF RESPONSE==0 GOTO IVRMAIN
IF NOTRANSACTIONS_CNT==3 GOTO CC_SERVICE
CONCAT filename,new_6_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO NOTRANSACTIONS_NAVI

:IVRMAIN
IF MODULE==IVROUTOFHOURS GOTO OUTOFHOURS
SETSCRIPTVALUE LANGUAGE,LANG
SCRIPTTRANSFER ivrmain2

:OUTOFHOURS
SETSCRIPTVALUE LANGUAGE,LANG
SCRIPTTRANSFER ivroutofhours2
HANGUP

:CARDS_OPERATOR
IF MODULE==IVROUTOFHOURS GOTO OUTOFHOURSOP
LET CONTEXT=ivrtooperator
LET CH=PARAM4
LET ACTION=ToOperator
CONCAT PARAM4,LANG,".",CONTEXT,".CC_PTB_Main"
SETSCRIPTVALUE CRMPARAM4,PARAM4
CURRENTDATETIME DATE_INSERT
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
GOTO stop_record(a)
CONCAT filename,new_11_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_14_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
ADDTOQUEUE CC PTB Main,CC PTB Main
FULLPLAYAMBIENT MUSIC.VOX
TRANSFERTOAGENTSYNC CC PTB Main,,RING.VOX
HANGUP

:CC_SERVICE
IF MODULE==IVROUTOFHOURS GOTO OUTOFHOURSOP
ADDTOQUEUE CC PTB Main,CC PTB Main
CONCAT PARAM4,LANG,".",CONTEXT,".CC_PTB_Main"
SETSCRIPTVALUE CRMPARAM4,PARAM4
CURRENTDATETIME DATE_INSERT
LET CH=PARAM4
LET ACTION=ToOperator
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
GOTO stop_record(a)
CONCAT filename,new_11_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_14_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
FULLPLAYAMBIENT MUSIC.VOX
TRANSFERTOAGENTSYNC CC PTB Main,20000,RING.VOX,DOCUMENTS
HANGUP

:CC_SERVICE1
FULLPLAYAMBIENT MUSIC.VOX
TRANSFERTOAGENTSYNC CC PTB Main,,RING.VOX
HANGUP

:DOCUMENTS
CONCAT filename,new_412_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_419_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_417_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO CC_SERVICE1

:PTBMAIN
IF MODULE==IVROUTOFHOURS GOTO OUTOFHOURSOP
ADDTOQUEUE CC PTB Main,CC PTB Main
CONCAT PARAM4,LANG,".",CONTEXT,".CC_PTB_Main"
SETSCRIPTVALUE CRMPARAM4,PARAM4
CURRENTDATETIME DATE_INSERT
LET CH=PARAM4
LET ACTION=ToOperator
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CONCAT filename,new_11_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_14_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO stop_record(a)
FULLPLAYAMBIENT MUSIC.VOX
TRANSFERTOAGENTSYNC CC PTB Main,30000,RING.VOX,MYCREDIT
HANGUP

:MYCREDIT
CONCAT filename,new_784_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_785_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_786_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_230_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GETDIGITS 1,10,10
IF RESPONSE==1 GOTO MYCREDITSMS
GOTO PTBMAIN_CONTINUE

:PTBMAIN_CONTINUE
FULLPLAYAMBIENT MUSIC.VOX
TRANSFERTOAGENTSYNC CC PTB Main,,RING.VOX
HANGUP

:MYCREDITSMS
CONCAT MESSAGE,"Dobra novyna! Vidteper diznavajtesja informatsiju ta splachujte za kredytom sydiachy na dyvani vdoma! Zahod`te na https://mycredit.platinumbank.com.ua"
LET PHONE_NO=ANI
INSERT() INTO sms(PHONE_NO,MESSAGE,STATUS)
GOTO PTBMAIN_CONTINUE

:COLLECTION_INBOUND
IF MODULE==IVROUTOFHOURS GOTO OUTOFHOURSOP
LET MODULE=TOCOLLECTION
LET CONTEXT=ivrwelcome
CURRENTDATETIME DATE_INSERT
LET CH=Call
LET ACTION=Answered
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
CONCAT filename,new_11_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_14_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO stop_record(a)
FULLPLAYAMBIENT MUSIC.VOX
ADDTOQUEUE Coll.Inbound_Z,Coll.Inbound_Z
TRANSFERTOAGENTSYNC Coll.Inbound_Z,30000,RING.VOX,HANGUP
HANGUP

:HANGUP
HANGUP

:MORTGAGE
IF MODULE==IVROUTOFHOURS GOTO OUTOFHOURSOP
//IF DNIS==8165 GOTO MIVR_OP
ADDTOQUEUE CC_Mortgage,CC_Mortgage
CONCAT PARAM4,LANG,".",CONTEXT,".CC_Mortgage"
CURRENTDATETIME DATE_INSERT
LET CH=PARAM4
LET ACTION=ToOperator
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
SETSCRIPTVALUE CRMPARAM4,PARAM4
CONCAT filename,main539_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,main526_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO stop_record(a)
FULLPLAYAMBIENT MUSIC.VOX
TRANSFERTOAGENTSYNC CC_Mortgage,,RING.VOX
HANGUP

:FINCOQUEUE
CONCAT PARAM4,LANG,".",CONTEXT,".CC_Finko"
CURRENTDATETIME DATE_INSERT
LET CH=PARAM4
LET ACTION=ToOperator
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
SETSCRIPTVALUE CRMPARAM4,PARAM4
CONCAT filename,new_11_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_14_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO stop_record(a)
FULLPLAYAMBIENT MUSIC.VOX
ADDTOQUEUE CC Finko, CC Finko
TRANSFERTOAGENTSYNC CC Finko
HANGUP

:MIVR_OP
ADDTOQUEUE CC Manager IVR,CC Manager IVR
CONCAT PARAM4,LANG,".",CONTEXT,".CC_Manager_IVR"
CURRENTDATETIME DATE_INSERT
LET CH=PARAM4
LET ACTION=ToOperator
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
SETSCRIPTVALUE CRMPARAM4,PARAM4
CONCAT filename,new_11_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_14_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
GOTO stop_record(a)
FULLPLAYAMBIENT MUSIC.VOX
TRANSFERTOAGENTSYNC CC Manager IVR,,RING.VOX
HANGUP


:OUTOFHOURSOP
CONCAT filename,new_45_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
HANGUP

:CARDS_NY (a)
CONCAT filename,cards_ny_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
RETURN

:3080SMS (a)
CONCAT MESSAGE,"Vidpravljaj sms z tekstom 1*",INN1,"*",RESPONSE," na nomer 3080 ta myttjevo otrymuj informatsiju za kredytom!Vartist povidomlennja zgidno Vashogo taryfnogo planu"
LET PHONE_NO=ANI
INSERT() INTO sms(PHONE_NO,MESSAGE,STATUS)
RETURN

:ivrinntime(a)
LET CONTEXT=ivrinntime
RETURN

:record(a)
LOG AM AJUNS AICI
LOG a
IF recorded >= 1 GOTO recorded1
LET recorded=1
RUNEXTERNALIVR RECORDIVR,FROMIVR,CALLTRACEID,QUEUE_ID,QUEUE,CHANNEL,INN1
LOG FROMIVR
:recorded1
RETURN

:stop_record(a)
LET recorded=0
RUNEXTERNALIVR RECORDIVR,FROMIVR,CALLTRACEID
RETURN

!ONHANGUP
RUNEXTERNALIVR RECORDIVR,FROMIVR,CALLTRACEID



:TOACTIVE
DECLARE CHTOGO,LONG
DECLARE TODIAL,STRING,"77777"

CONCAT TODIAL,DNIS
DIAL TODIAL,ANI,CHTOGO
HANGUP








































































































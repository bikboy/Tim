CHECKFAILOVERSTATUS TOACTIVE

DECLARE CONTEXT
DECLARE DATE_INSERT
DECLARE CH
DECLARE ACTION
DECLARE MODULE
DECLARE BATCH
DECLARE TOKEN,,0
DECLARE QUEUE_ID,LONG
DECLARE varDATE
DECLARE varTIME
DECLARE LANG,,N
DECLARE IVRLANGUAGE_CNT,WORD,0
DECLARE PARAM4
DECLARE filename
DECLARE CELLOP
DECLARE L
DECLARE a
DECLARE date
DECLARE MESSAGE
DECLARE PHONE_NO
DECLARE STATUS,,0
DECLARE sms_type
DECLARE Account_num

DBMS DRIVER=SQL Server;SERVER=IMB-MSSQLST;DATABASE=Server;UID=mcc;PWD=mcc;
LET MODULE=standartIVR
LET CONTEXT=ivrwelcome
CURRENTDATETIME DATE_INSERT
LET CH=Call
LET ACTION=Answered
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)

GETQUEUE QUEUE_ID,ID
GETSCRIPTVALUE "MODULENAME",MODULE
CURRENTDATETIME varDATE
CURRENTTIME varTIME
MID ANI,0,3,CELLOP
CURRENTDATE date
MID date,0,10,date
LET BATCH=ANI
IF MODULE==POTENTIAL GOTO POTENTIAL
IF MODULE==SALARY GOTO SALARY
IF MODULE==VIP GOTO VIP
IF DNIS==8167 GOTO VIP
IF DNIS==8195 GOTO 0800
IF DNIS==8196 GOTO 3080
IF DNIS==8165 GOTO MIVR
//IF DNIS==8162 GOTO AIVR
IF DNIS==8170 GOTO 0800
IF DNIS==8203 GOTO 3080
IF DNIS==8207 GOTO 0800

:0800
SETSCRIPTVALUE MODULENAME,IVR
NIGHTSERVICE OUTOFHOURS
GOTO TIME

:MIVR
LET MODULE=mIVR
SETSCRIPTVALUE MODULENAME,mIVR
NIGHTSERVICE OUTOFHOURS
LET CONTEXT=mivrwelcome
CURRENTDATETIME DATE_INSERT
LET CH=Call
LET ACTION=Answered
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
GOTO TIME

:AIVR
LET MODULE=AIVR
SETSCRIPTVALUE MODULENAME,AIVR
NIGHTSERVICE OUTOFHOURS
LET CONTEXT=aivrwelcome
CURRENTDATETIME DATE_INSERT
LET CH=Call
LET ACTION=Answered
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
GOTO TIME

:TIME
IF varTIME<12:00:00 GOTO MORNING
IF varTIME<18:00:00 GOTO DAY
IF varTIME>18:00:00 GOTO EVENING

:MORNING
INTERRUPTPLAY new_2_UA.vox,,0
INTERRUPTPLAY new_4_UA.vox,,0
IF CELLOP==050 GOTO IVRLANGUAGE3080
IF CELLOP==066 GOTO IVRLANGUAGE3080
IF CELLOP==095 GOTO IVRLANGUAGE3080
IF CELLOP==099 GOTO IVRLANGUAGE3080
IF CELLOP==067 GOTO IVRLANGUAGE3080
IF CELLOP==068 GOTO IVRLANGUAGE3080
IF CELLOP==096 GOTO IVRLANGUAGE3080
IF CELLOP==097 GOTO IVRLANGUAGE3080
IF CELLOP==098 GOTO IVRLANGUAGE3080
IF CELLOP==039 GOTO IVRLANGUAGE3080
IF CELLOP==063 GOTO IVRLANGUAGE3080
IF CELLOP==073 GOTO IVRLANGUAGE3080
IF CELLOP==093 GOTO IVRLANGUAGE3080
GOTO IVRLANGUAGE

:DAY
INTERRUPTPLAY new_1_UA.vox,,0
INTERRUPTPLAY new_4_UA.vox,,0
GOTO IVRLANGUAGE

:EVENING
INTERRUPTPLAY new_3_UA.vox,,0
INTERRUPTPLAY new_4_UA.vox,,0
IF CELLOP==050 GOTO IVRLANGUAGE3080
IF CELLOP==066 GOTO IVRLANGUAGE3080
IF CELLOP==095 GOTO IVRLANGUAGE3080
IF CELLOP==099 GOTO IVRLANGUAGE3080
IF CELLOP==067 GOTO IVRLANGUAGE3080
IF CELLOP==068 GOTO IVRLANGUAGE3080
IF CELLOP==096 GOTO IVRLANGUAGE3080
IF CELLOP==097 GOTO IVRLANGUAGE3080
IF CELLOP==098 GOTO IVRLANGUAGE3080
IF CELLOP==039 GOTO IVRLANGUAGE3080
IF CELLOP==063 GOTO IVRLANGUAGE3080
IF CELLOP==073 GOTO IVRLANGUAGE3080
IF CELLOP==093 GOTO IVRLANGUAGE3080
GOTO IVRLANGUAGE

:3080
LET MODULE=IVR3080
SETSCRIPTVALUE MODULENAME,IVR3080
NIGHTSERVICE OUTOFHOURS
IF varTIME<12:00:00 GOTO MORNING3080
IF varTIME<18:00:00 GOTO DAY3080
IF varTIME>18:00:00 GOTO EVENING3080

:POTENTIAL
LET MODULE=IVRPOTENTIAL
SETSCRIPTVALUE MODULENAME,POTENTIAL
NIGHTSERVICE OUTOFHOURS
IF DNIS==8195 GOTO 0800
IF DNIS==8196 GOTO 3080
IF varTIME<12:00:00 GOTO MORNING
IF varTIME<18:00:00 GOTO DAY
IF varTIME>18:00:00 GOTO EVENING

:SALARY
LET MODULE=IVRSALARY
SETSCRIPTVALUE MODULENAME,SALARY
NIGHTSERVICE OUTOFHOURS
IF DNIS==8195 GOTO 0800
IF DNIS==8196 GOTO 3080
IF varTIME<12:00:00 GOTO MORNING3080
IF varTIME<18:00:00 GOTO DAY3080
IF varTIME>18:00:00 GOTO EVENING3080


:VIP
LET MODULE=VIP
SETSCRIPTVALUE MODULENAME,VIP
NIGHTSERVICE OUTOFHOURS
IF varTIME<12:00:00 GOTO MORNING
IF varTIME<18:00:00 GOTO DAY
IF varTIME>18:00:00 GOTO EVENING

:MORNING3080
INTERRUPTPLAY new_2_UA.vox,,0
INTERRUPTPLAY new_4_UA.vox,,0
GOTO CELLOP

:DAY3080
INTERRUPTPLAY new_1_UA.vox,,0
INTERRUPTPLAY new_4_UA.vox,,0
GOTO CELLOP

:EVENING3080
INTERRUPTPLAY new_3_UA.vox,,0
INTERRUPTPLAY new_4_UA.vox,,0
GOTO CELLOP

:CELLOP
IF CELLOP==050 GOTO MTS
IF CELLOP==066 GOTO MTS
IF CELLOP==095 GOTO MTS
IF CELLOP==099 GOTO MTS
IF CELLOP==067 GOTO KS
IF CELLOP==068 GOTO KS
IF CELLOP==096 GOTO KS
IF CELLOP==097 GOTO KS
IF CELLOP==098 GOTO KS
IF CELLOP==039 GOTO KS
IF CELLOP==063 GOTO LIFE
IF CELLOP==073 GOTO LIFE
IF CELLOP==093 GOTO LIFE
IF CELLOP==091 GOTO KS
GOTO IVRLANGUAGE3080


:MTS
INTERRUPTPLAY new_426_UA.vox,,0
INTERRUPTPLAY new_62_UA.vox,,0
INTERRUPTPLAY new_60_UA.vox,,0
INTERRUPTPLAY new_58_UA.vox,,0
GOTO IVRLANGUAGE3080
:KS
INTERRUPTPLAY new_426_UA.vox,,0
INTERRUPTPLAY new_62_UA.vox,,0
INTERRUPTPLAY new_61_UA.vox,,0
INTERRUPTPLAY new_58_UA.vox,,0
GOTO IVRLANGUAGE3080

:LIFE
INTERRUPTPLAY new_426_UA.vox,,0
INTERRUPTPLAY new_62_UA.vox,,0
//INTERRUPTPLAY new_59_UA.vox,,0
INTERRUPTPLAY new_59v2_UA.vox,,0
INTERRUPTPLAY new_58_UA.vox,,0
GOTO IVRLANGUAGE3080

:Cards_IVR
LET MODULE=Cards_IVR
SETSCRIPTVALUE MODULENAME,Cards_IVR
NIGHTSERVICE OUTOFHOURS
IF varTIME<12:00:00 GOTO MORNINGCARDS
IF varTIME<18:00:00 GOTO DAYCARDS
IF varTIME>18:00:00 GOTO EVENINGCARDS

:MORNINGCARDS
INTERRUPTPLAY new_2_UA.vox,,0
INTERRUPTPLAY new_4_UA.vox,,0
INTERRUPTPLAY new_503_UA.vox,,0
GOTO IVRLANGUAGE

:DAYCARDS
INTERRUPTPLAY new_1_UA.vox,,0
INTERRUPTPLAY new_4_UA.vox,,0
INTERRUPTPLAY new_503_UA.vox,,0
GOTO IVRLANGUAGE

:EVENINGCARDS
INTERRUPTPLAY new_3_UA.vox,,0
INTERRUPTPLAY new_4_UA.vox,,0
INTERRUPTPLAY 503_UA.vox,,0
GOTO IVRLANGUAGE


:3080INFO (a)
LET L=UA
CONCAT filename,new_472_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_16_,L,.vox
INTERRUPTPLAY filename,,0
LET filename=
RETURN

:IVRLANGUAGE3080
INCREMENT IVRLANGUAGE_CNT
LET CONTEXT=ivrlanguage
CURRENTDATETIME DATE_INSERT
LET CH=Message
LET ACTION=Begin
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
IF DNIS==8195 GOTO 3080INFO(a)
INTERRUPTPLAY new_5_UA.VOX,,0
INTERRUPTPLAY new_71_UA.vox,,0
INTERRUPTPLAY new_5_RU.vox,,0
INTERRUPTPLAY new_72_RU.vox,,0
GETDIGITS 1,5,5
CURRENTDATETIME DATE_INSERT
LET CH=Options
LET ACTION=RESPONSE
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
IF RESPONSE==1 GOTO UA
IF RESPONSE==2 GOTO RU
IF IVRLANGUAGE_CNT==3 TERMINATE
FULLPLAY new_6_UA.vox,,0
GOTO IVRLANGUAGE3080

:IVRLANGUAGE
INCREMENT IVRLANGUAGE_CNT
LET CONTEXT=ivrlanguage
CURRENTDATETIME DATE_INSERT
LET CH=Message
LET ACTION=Begin
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
IF  DNIS==8202 GOTO 3080INFO(a)
INTERRUPTPLAY new_5_UA.VOX,,0
INTERRUPTPLAY new_71_UA.vox,,0
INTERRUPTPLAY new_5_RU.vox,,0
INTERRUPTPLAY new_72_RU.vox,,0
GETDIGITS 1,5,5
CURRENTDATETIME DATE_INSERT
LET CH=Options
LET ACTION=RESPONSE
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
IF RESPONSE==1 GOTO UA
IF RESPONSE==2 GOTO RU
IF IVRLANGUAGE_CNT==3 GOTO CC_SERVICE
FULLPLAY new_6_UA.vox
GOTO IVRLANGUAGE


:UA
SETSCRIPTVALUE LANGUAGE,"UA"
GOTO IVRMAIN

:RU
SETSCRIPTVALUE LANGUAGE,"RU"
GOTO IVRMAIN


:IVRMAIN
SCRIPTTRANSFER ivrmain2

:OUTOFHOURS
SCRIPTTRANSFER ivroutofhours2

:CC_SERVICE
ADDTOQUEUE CC PTB Main,CC PTB Main
CONCAT PARAM4,LANG,".",CONTEXT,".CC_PTB_Main"
CURRENTDATETIME DATE_INSERT
LET CH=PARAM4
LET ACTION=ToOperator
INSERT() INTO loging(MODULE,BATCH,TOKEN,QUEUE_ID,DATE_INSERT,CHANNEL,CONTEXT,CH,ACTION,DNIS,SAMPLEID,CALLTRACEID)
SETSCRIPTVALUE CRMPARAM4,PARAM4
CONCAT filename,new_11_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
CONCAT filename,new_14_,LANG,.vox
INTERRUPTPLAY filename,,0
LET filename=
FULLPLAYAMBIENT MUSIC.VOX
TRANSFERTOAGENTSYNC CC PTB Main,30000,RING.VOX,CHECK_PHONE
HANGUP

:CHECK_PHONE
IF CELLOP==050 GOTO SENDSMS
IF CELLOP==066 GOTO SENDSMS
IF CELLOP==095 GOTO SENDSMS
IF CELLOP==099 GOTO SENDSMS
IF CELLOP==067 GOTO SENDSMS
IF CELLOP==068 GOTO SENDSMS
IF CELLOP==096 GOTO SENDSMS
IF CELLOP==097 GOTO SENDSMS
IF CELLOP==098 GOTO SENDSMS
IF CELLOP==039 GOTO SENDSMS
IF CELLOP==063 GOTO SENDSMS
IF CELLOP==073 GOTO SENDSMS
IF CELLOP==093 GOTO SENDSMS
IF CELLOP==091 GOTO SENDSMS
FULLPLAYAMBIENT MUSIC.VOX
TRANSFERTOAGENTSYNC CC PTB Main,,RING.VOX
HANGUP


:SENDSMS
LET PHONE_NO=ANI
LET MESSAGE=NOVYNA! Vidteper diznavaytesj vsyu informatsiyu po vashomu kredytu online shvydko, zruchno, tsilodobovo! Zakhodjte na mycredit.platinumbank.com.ua
INSERT() INTO sms(PHONE_NO,MESSAGE,STATUS,MODULE,sms_type,Account_num)
FULLPLAYAMBIENT MUSIC.VOX
TRANSFERTOAGENTSYNC CC PTB Main,,RING.VOX
HANGUP



:CC_NY1
INTERRUPTPLAY cc_ny_day1_UA.vox,,0
GOTO IVRLANGUAGE


:CC_NY2
INTERRUPTPLAY cc_ny_day2_UA.vox,,0
GOTO IVRLANGUAGE

:TOACTIVE
DECLARE CHTOGO,LONG
DECLARE TODIAL,STRING,"77777"
CONCAT TODIAL,DNIS
DIAL TODIAL,ANI,CHTOGO
HANGUP























































































































































